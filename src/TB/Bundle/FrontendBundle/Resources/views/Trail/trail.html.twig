{% extends '::base.html.twig' %}

{% block meta %}
{# add canonical link for search engines when displaying trail in relation with editorials or events #}
{% if editorial != null or event != null %}
<link rel="canonical" href="{{ url('trail', {'trailSlug': trail.slug}) }}"/>
{% endif %}
{% endblock %}

{% block title %}{{ trail.name }}{% endblock %}

{% block stylesheets %}
<link href="{{ asset('assets/css/trail.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block body %}
<script>
var TB_APP = 'TrailApp';
var TB_TRAIL_ID = {{ trail.id }};
</script>

<div id="small_sponsor_bar">
	<div class="sponsor_content">
		<div class="link"><a href=""><img src="{{ asset('assets/img/sponsor/arrow_small.png') }}">&nbsp;&nbsp;&nbsp;&nbsp;Back to editorial</a></div>
		<div class="brand">
			<div class="strap">This editorial has been brought to you by</div>
			<div class="logo"><img src="{{ asset('assets/img/sponsor/logo_small.png') }}"></div>
		</div>
	</div>
</div>

<div id="content_view">
    <div id="trailplayer">
        <div id="trail_views">        
            <div id="trail_map_view"></div>
            <div id="trail_slide_view"></div>      
        </div>
        <div id="trail_info">   
            {% if user.avatar != '' %}
                <div class="trail_avatar"><a href="{{ path('profile', {'name': user.name}) }}"><img src="https://s3-eu-west-1.amazonaws.com/trailburning-assets/images/profile/{{ user.name }}/{{ user.avatar }}" border="0"></a></div>    
            {% endif %}   
            <div class="trail_title{% if user.avatar == '' %} no_avatar{% endif %}">
                {% if event %}
                    <h2 class="tb tb-title">{{ event.title }}</h2>
                    <br/>
                    <h2 class="tb tb-title">{{ trail.name }}</h2>
                {% else %}
                    <h2 class="tb tb-title">{{ trail.name }}</h2>
                    <br/>
                    <h2 class="tb tb-title">{{ trail.region }}</h2>
                {% endif %}
                {% if user.id != 1 %}
                    <br/> 
                    {% if user is UserProfile %}
                        <div class="author">by <strong>{{ user.firstName }} {{ user.lastName }}</strong></div>
                    {% elseif user is BrandProfile %}
                        <div class="author">by <strong>{{ user.displayName }}</strong></div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        <div id="view_map_btns">        
            <div class='controls'>
                <span class="btn btn-tb zoomin_btn">+</span>          
                <span class="btn btn-tb zoomout_btn">-</span>
                <span class="btn btn-tb view_btn">Satellite</span>          
            </div>    
        </div>    
        <div id="view_player_btns">
            <div id="slideshow_toggle"><span class="button"></span></div>
            <div id="view_toggle"><span id="view_toggle_btn" class="button">Change View</span></div>
        </div>
    </div>
  
    <div class="panel_container">       
        <div class="panel_content_container">       
            <div class="panel_content">       
                <div id="bigbar">
                    {{ include('TBFrontendBundle:Default:breadcrumb.html.twig', breadcrumb) }}
                    {{ include('TBFrontendBundle:Default:share.html.twig') }}                     
                </div>

                <div class="panels clearfix">     
                    <div class="two_col_panels">
                        <div class="left">
                            <div class="panel trail_detail_panel">
                                <div class="content">
                                    <h3 class="tb">About the trail</h3>
                                    <h4 class="tb">{{ trail.about|nl2br }}</h4>
                                </div>
                            </div>
                        </div>  
                        <div class="right">
                            <div id="trail_weather_view" class="panel trail_weather_panel"></div>
                            {% if event and relatedTrails %}
                				<div class="event_trails_container">
                                {% for relatedTrail in relatedTrails %}                                
				                    {% if relatedTrails|length == 1 %}
				                        <div class="panel big_event_trail">
				                            <h3 class="tb">{{ relatedTrail.routeType ? relatedTrail.routeType.name : 'Run' }}</h3>
				                            <a href="{{ path('trail', {trailSlug: relatedTrail.slug}) }}">
				                                <div class="photo tb-photo-btn">
				                                    <div class="image_container"><img src="http://app.resrc.it/http://s3-eu-west-1.amazonaws.com/{{ relatedTrail.routeMedias[0].media.versions[0].path }}" class="resrc scale" border="0"/></div>
				                                    <div class="card_title">
				                                        {% if relatedTrail.eventRoutes[0].date %}
				                                            <h1>{{ relatedTrail.eventRoutes[0].date|date('d.m.y') }}</h1>
				                                            <br/>
				                                        {% endif %}
				                                        <h1>{{ relatedTrail.name }}</h1>
				                                    </div>
				                                </div>
				                            </a>
				                            <div class="details">
				                                <div class="logo"><!--<img src="http://s3-eu-west-1.amazonaws.com/trailburning-assets/images/events/tfor/trail_logo_ashmei.png" border="0"/>--></div>
				                                <div class="more"><a class="btn btn-tb" href="{{ path('trail', {trailSlug: relatedTrail.slug}) }}">More</a></div>
				                            </div>
				                        </div>
				                    {% else %}                                
				                        <div class="panel event_trail">
				                        	<h3 class="tb">{{ relatedTrail.shortName ? relatedTrail.shortName : relatedTrail.name  }}</h3>
				                        	<a href="{{ path('trail', {trailSlug: relatedTrail.slug}) }}">
				                                <div class="detail">
				                                    {% if relatedTrail.tags.ascent %}
				                                        <div class="terrain">
				                                            <h2 class="tb">{{ relatedTrail.tags.ascent|dimension_format('m') }}</h2>
				                                            {% if relatedTrail.tags.descent %}
				                                            <div class="desc">D+ / {{ relatedTrail.tags.descent|dimension_format('m') }} D-</div>
				                                            {% endif %}
				                                        </div>                                              
				                                    {% endif %}
				                                    <div class="length">
				                                        <h2 class="tb">{{ relatedTrail.length|dimension_format('km', 1000) }}</h2>
				                                        <div class="desc">Length</div>
				                                    </div>
				                                </div>
				                            </a>
				                            <div class="more"><a class="btn btn-tb"  href="{{ path('trail', {trailSlug: relatedTrail.slug}) }}">More</a></div>
				                        </div>				                        
									{% endif %}				                        
                                {% endfor %}
                                </div>
                            {% endif %}
                        </div>  
                    </div>
                    
                	<div class="panel editorial_panel">
                	
		  				<div class="editorial_header">
			  				<div class="header"><h3 class="tb">Picture perfect trails in the Alps</h3></div>
			  				<div class="line"></div>
			  				<div class="author"><h4 class="tb">Discover more trails from this editorial by <strong>Magdalena Zeslawska</strong>&nbsp;&nbsp;&nbsp;<span class="date">15/01/2014</span></h4></div>
                		</div>
                	
				    	<div class="editorial_cards clearfix">
				    	
					    	<div class="trail_card_sticker">
								<div class="panel trail_card_panel">
		        					<div class="title"><h3 class="tb">Mountains</h3></div>
							        <a href="../trail/30km">
							        <div class="photo tb-photo-btn">
							        	<div class="image_container"><img src="http://app.resrc.it/o=80/http://s3-eu-west-1.amazonaws.com/trailburning-assets/images/events/ultraks/event_header.jpg" class="resrc scale" border="0"/></div>
							          	<div class="card_title">
							            <h1>30K Race</h1>
							            <br />
							            <h1>Valais</h1>
							        	</div>
							       	</div>
							        </a>
							        <div class="summary">
							        	<div class="sponsor"><a href="event/ultraks"><img src="http://s3-eu-west-1.amazonaws.com/trailburning-assets/images/events/ultraks/card_logo_ultraks.png"></a></div>
									</div>						       		
							 	</div>						 	
						 	</div>
	
					    	<div class="trail_card_sticker">				    		
								<div class="panel trail_card_panel">
	        						<div class="title"><h3 class="tb">Mountains</h3></div>
	        						<a href="../trail/e51">
	        						<div class="photo tb-photo-btn">
							        	<div class="image_container"><img src="http://app.resrc.it/o=80/http://s3-eu-west-1.amazonaws.com/trailburning-assets/images/events/eiger/event_header.jpg" class="resrc scale" border="0"/></div>
	          							<div class="card_title">
							            <h1>E51</h1>
							            <br />
							            <h1>Grindelwald</h1>
	          							</div>
	        						</div>
	        						</a>
	        						<div class="summary">
							        	<div class="sponsor"><a href="event/eiger"><img src="http://s3-eu-west-1.amazonaws.com/trailburning-assets/images/events/eiger/card_logo_eiger.png"></a></div>
	        						</div>
	      						</div>				    		
						 	</div>
						 	
					    	<div class="trail_card_sticker">
								<div class="panel trail_card_panel">
						        	<div class="title"><h3 class="tb">Mountains</h3></div>
						        	<a href="">
						        	<div class="photo tb-photo-btn">
							        	<div class="image_container"><img src="http://app.resrc.it/o=80/http://s3-eu-west-1.amazonaws.com/trailburning-media/74339e8b970216338f6afbedf9b8c45ca489aebb.jpg" class="resrc scale" border="0"/></div>
						          		<div class="card_title">
							            <h1>Haute Route</h1>
							            <br />
							            <h1>Haute-Savoie</h1>
						          		</div>
						        	</div>
						        	</a>
	        						<div class="summary">
								    	<div class="avatar"><a href="profile/mattallbeury"><img src="{{ asset('assets/img/avatars/avatar_ma.png') }}"></a></div>
								        <div class="detail">
								        by <strong>Matt Allbeury</strong>
								        <div class="stars">
							            	<div class="star_full"></div>
							              	<div class="star_full"></div>
							              	<div class="star_full"></div>
							              	<div class="star_half"></div>
							              	<div class="star"></div>
							           	</div>
								     	</div>
	        						</div>
						      	</div>              				    		
						 	</div>
				    	
				    	</div>  
                    </div>
                    
                </div>
            </div>    
        </div>
  
        <div id="trail_overlay">
            <div class="overlay_content">
                <div id="trail_stats_view" class="trailstats_panel"></div>
                    <div id="trail_altitude_view" class="trail_altitude_panel"></div>
                    <div id="trail_mini_view">
                    <div id="trail_minimap_view" class="trail_minimap"></div>
                    <div id="trail_minislide_view" class="trail_minislide"></div>
                    <div class='border_top'></div>
                    <div class='border_left'></div>
                    <div class='toggle_view_button'></div>          
                </div>
            </div>
            <div class="overlay_pull"><span class="button"></span></div>
        </div>
        <div class="line_break"></div>    
    </div>  
</div>  
          

<script type="text/template" id="trailStatsViewTemplate">
  <div class="content">
    <div class="length"></div>
    <div class="terrain"></div>          
  </div>
</script>

<script type="text/template" id="trailMiniMapViewTemplate">
  <div id='minimap'></div>  
</script>

<script type="text/template" id="trailMiniSlideViewTemplate">
  <div id='minislide'>
    <div class="photos_container"></div>
  </div>
</script>

<script type="text/template" id="trailSlideViewTemplate">
  <div class="photos_container"></div>
  <div class="slide_btns">
    <div class="left"></div>
    <div class="right"></div>
  </div>  
  <div class="loader_container">
    <div class="loader"></div>
  </div>  
</script>

<script type="text/template" id="trailSlidePhotoViewTemplate">
  <div class="image_container fade_on_load"><img src="http://app.resrc.it/O=80/http://s3-eu-west-1.amazonaws.com/<%= versionLargePath%>" class="resrc scale" /></div>  
</script>

<script type="text/template" id="trailMapViewTemplate">
  <div class="map_container">
    <div id='map_large'></div>
  </div>
</script>

<script type="text/template" id="traiAltitudeViewTemplate">
  <div class="profile">
    <canvas id="graph"></canvas>
    <div class="location"></div>      
  </div>
</script>

<script type="text/template" id="trailMediaMarkerViewTemplate">
  <div class="marker_container">
    <div class="marker"></div>
    <div class="alt"></div>  
  </div>
</script>

<script type="text/template" id="trailWeatherViewTemplate">
  <div class="content">
    <h3 class="tb">Today&#39;s weather</h3>
    <div class="desc"></div>
    <div class="detail clearfix">                  
      <div class="text">
        <div class="temp"></div>
        <div class="wind"></div>
      </div>
      <div class="icon"></div>
    </div>
  </div>
</script>
{% endblock %}