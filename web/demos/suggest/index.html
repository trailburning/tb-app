<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>selbst.de - Test Suche</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-1.7.2.js"></script>
    <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="assets/js/elasticsearch.jquery.js"></script>
    <style>
        .ui-autocomplete-loading {
            background: white url('http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.2/themes/smoothness/images/ui-anim_basic_16x16.gif') right center no-repeat;
        }
        .ui-autocomplete {
            float: right;
            font-size: .9em;
        }
        .ui-autocomplete li span {
            float: right;
        }
    </style>
    <script>

        $(function() {
            var cache = {};
            var client = new $.es.Client({    
                hosts: 'e7p15amb:4yexy8z21pg5eee0@boxwood-7916136.eu-west-1.bonsai.io'
            });
            
            $('#q').autocomplete({
                minLength: 2,
                delay: 0,
                source: function(request, response ) {
                    var term = request.term;
                    if (term in cache) {
                        response(cache[term]);
                        return;
                    }
                    
                    client.search({
                        index: 'trailburning',
                        body: {
                            query: {
                                match: {
                                  suggest_nge: term
                                }
                            }
                        }
                    }).then(function (resp) {
                        var suggestions = resp.hits.hits;
                        cache[term] = suggestions;
                        response(suggestions); 
                    }, function (err) {
                        console.log(err.message);
                    });
                }
            }).data('ui-autocomplete')._renderItem = function(ul, item) {
                return $('<li>')
                    .append('<a>' + item._source.suggest_text + '</a>')
                    .appendTo(ul);
            };
        });
    </script>
</head>
<body>
<form name="search" method="GET" action="index.php">
    <div class="ui-widget">
        <input id="q" name="q" size="50" value="" />
    </div> 
</form>

</body>
</html>