{% extends "::base.html.twig" %}

{% block title %}{{ editorial.title }}{% endblock %}

{% block stylesheets %}
<link href="{{ asset('assets/css/editorial.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block body %}
<script>
var TB_APP = 'EditorialApp';
{% if app.user %}		
var TB_USER_ID = {{ app.user.id }};
{% endif %}
var TB_EDITORIAL_TRAILS = [
    {% for editorialRoute in editorialRoutes %}
        {% set route = editorialRoute.route %}
        { long: {{ route.centroid.longitude }}, lat: {{ route.centroid.latitude }}, short_name: "{{ route.shortName }}", region: "{{ route.region }}", url: "{{ path('editorial_trail', {trailSlug: route.slug, editorialSlug: editorial.slug}) }}" },          
    {% endfor %}
];
</script>

<div id="big_sponsor_bar">
	<div class="sponsor_content">
		<div class="link"><a href="{{ app.request.baseUrl }}/inspire"><img src="{{ asset('assets/img/sponsor/arrow_big.png') }}">&nbsp;&nbsp;&nbsp;&nbsp;Back to Inspire</a></div>
		<div class="brand">
			<div class="strap">brought to you by</div>
			<div class="logo"><a href="{{ path('profile', {'name': 'ashmei'}) }}"><img src="https://s3-eu-west-1.amazonaws.com/trailburning-assets/images/profile/ashmei/editorial_sponsor_logo_big.png" border="0"></a></div>
		</div>
		<div class="inspire_logo"><img src="{{ asset('assets/img/sponsor/inspire_logo.png') }}"></div>						
	</div>
</div>

<div id="small_sponsor_bar">
	<div class="sponsor_content">
		<div class="link"><a href="{{ app.request.baseUrl }}/inspire"><img src="{{ asset('assets/img/sponsor/arrow_small.png') }}">&nbsp;&nbsp;&nbsp;&nbsp;Back to Inspire</a></div>
		<div class="brand">
			<div class="strap">brought to you by</div>
			<div class="logo"><a href="{{ path('profile', {'name': 'ashmei'}) }}"><img src="https://s3-eu-west-1.amazonaws.com/trailburning-assets/images/profile/ashmei/editorial_sponsor_logo_small.png" border="0"></a></div>
		</div>
	</div>
</div>

<div class="panel_content">          
	<div class="panels clearfix">               	
		<div class="panel editorial_panel">
	  		<div class="header clearfix">
	  			<div class="title"><h1 class="tb">{{ editorial.title|nl2br }}</h1></div>
	  			<div class="tb-avatar tb-avatar-feature"><div class="photo"><a href="{{ path('profile', {'name': editorial.user.name}) }}">
            	<img src="{{ get_user_avatar_url(editorial.user) }}">
	  			</a></div></div>
	  		</div>
	  		<div class="hero">
				<div class="image_container fade_on_load"><img src="http://app.resrc.it/o=80/http://s3-eu-west-1.amazonaws.com/trailburning-assets/images/editorial/{{ editorial.slug }}/{{ editorial.image }}" class="scale"></div>
				{% if editorial.imageCredit is not null %}				
				  <div class="tb-credit">Photo credit: Â© <a href="{{ editorial.imageCreditURL }}" onClick="trackOutboundLink(this, 'Outbound Links', '{{ editorial.imageCreditUrl | url_truncate }}'); return false;">{{ editorial.imageCredit }}</a></div>
				{% endif %}
			</div>
	  		<div class="content">
	  			<div class="content_header">
		  			<div class="header">by <strong>{{ editorial.user.title }}</strong>&nbsp;&nbsp;&nbsp;<span class="date">{{ editorial.date|date('d/m/Y') }}</span></div>
		  			<div class="line"></div>
		  			<div class="share_bar">
      					{{ include('TBFrontendBundle:Default:share.html.twig') }} 	  				
		  			</div>
	  			</div>	  			
	  			
				<div id="column_wrapper_intro" class="column_wrapper">
	  			<div class="columns">
    	  			<h4 class="tb">	  				
                        {{ editorial.synopsis|nl2br }}
    				</h4>
                    {{ editorial.text|raw }}
	  			</div>	  			
	  			</div>	  			
	  			
	  			<div id="trail_header" class="section_header clearfix">
		  			<div class="header"><h2 class="tb">Discover the Trails</h2></div>
		  			<div class="line"></div>
	  			</div>

                {% if editorialRoutes and editorialRoutes|length > 0 %}

				{% if editorialRoutes[0].text is not null %}

				<div class="editorial_cards clearfix">
                
                	{% for editorialRoute in editorialRoutes %}
                        {% set route = editorialRoute.route %}
						<div class="editorial_card{% if loop.index0 is odd %} align_right{% endif %}">
                            {% if loop.index0 is even %}
    							<div class="sticker_container">			
    							{{ include('TBFrontendBundle:Trail:editorial_trailcard.html.twig', {route: route, editorial: editorial}) }}
    							</div>
                            {% endif %}
							<div class="card_column_wrapper column_wrapper">
				  			<div class="columns">							
				  			<h4 class="tb">{{ editorialRoute.synopsis|nl2br }}</h4>
							{{ editorialRoute.text|raw }}
							</div>
							</div>
                            {% if loop.index0 is odd %}
    							<div class="sticker_container">			
    							{{ include('TBFrontendBundle:Trail:editorial_trailcard.html.twig', {route: route, editorial: editorial}) }}
    							</div>
                            {% endif %}
						</div>										        		        		
                    {% endfor %}

  				</div>
  				
	  			<div id="region_header" class="section_header clearfix">
		  			<div class="header"><h2 class="tb">Discover the Region</h2></div>
		  			<div class="line"></div>
	  			</div>
  				
				<div id="editorial_region_view">		  				
					<div id="editorial_map_view" class="editorial_map"></div>		  				
	            	<div class='border_top'></div>
	            	<div class='border_left'></div>
  				</div>
  				
				{% elseif editorialRoutes[0].text is null %}

				<div class="single_region">		  				

				<div id="editorial_region_view">		  				
					<div id="editorial_map_view" class="editorial_map"></div>		  				
	            	<div class='border_top'></div>
	            	<div class='border_left'></div>
  				</div>

				<div class="editorial_cards clearfix">
                
            	{% for editorialRoute in editorialRoutes %}
					<div class="editorial_card">
						<div class="sticker_container">			
						{{ include('TBFrontendBundle:Trail:editorial_trailcard.html.twig', {route: editorialRoute.route, editorial: editorial}) }}
						</div>
					</div>							
                {% endfor %}
				
				</div>
				
				</div>							
				
				{% endif %}
                
                {% endif %}

	  		</div>		  		
	  	</div>
	</div>
</div>  

{% endblock %}

{% block javascripts %}
<script type="text/template" id="editorialMapViewTemplate">
  <div id='map'></div>  
</script>
<script src="{{ asset('assets/js/libs/jquery.columnizer.js') }}"></script>

{% endblock %}